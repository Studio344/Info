# GitHub Copilot に128項目のサイト改善を任せてみた — AI駆動リファクタリングの実践記

ポートフォリオサイト studio344.net の改善を GitHub Copilot に依頼し、5つの観点から128項目の改善提案を受け、そのすべてを4フェーズで実装しました。この記事では、AIとのペアプログラミングで得られた成果と教訓を共有します。

## きっかけ

サイトは動いていたものの、以下の課題がありました:

- セキュリティヘッダー未設定
- パフォーマンス最適化不足
- アクセシビリティ対応が不完全
- PWA 非対応
- ブログの UX が改善の余地あり

手動で一つずつ対応するのは膨大な工数がかかります。そこで、GitHub Copilot に「サイト全体を5つの観点で分析して改善提案を出して」と依頼しました。

## 5つの分析観点

Copilot に指示した分析の切り口:

| 観点 | 内容 | 提案数 |
|------|------|--------|
| 🔒 セキュリティ | CSP, SRI, Cookie同意, 外部リンク安全対策 | 24項目 |
| ⚡ パフォーマンス | 画像最適化, 遅延読込, スクロールスロットリング | 28項目 |
| ♿ アクセシビリティ | ARIA属性, キーボード操作, WCAG準拠 | 32項目 |
| 🎨 UX/UI | スケルトンUI, SNSシェア, 関連記事, TOC | 26項目 |
| 🛠️ DevOps | CI/CD, RSS生成, サイトマップ, PR テンプレート | 18項目 |

合計**128項目**の改善提案が生成されました。

## 4フェーズ実装

128項目を優先度順に4フェーズに分けて実装:

### Phase 1: クイックウィン（即効性の高い修正）

- 全ページに CSP メタタグ追加
- 外部リンクに `rel="noopener noreferrer"` 追加
- 画像に `loading="lazy"`, `width`, `height` 属性追加
- ARIA 属性の修正
- `Skip to content` リンク追加

### Phase 2: セキュリティ & GDPR

- Cookie 同意バナー実装
- AdSense の条件付きローリング
- SRI ハッシュの追加と検証
- `X-Content-Type-Options`, `Referrer-Policy` メタタグ

### Phase 3: UX 改善

- ブログのスケルトンローディング UI
- SNS シェアボタン（Twitter, コピー, Web Share API）
- 関連記事の自動表示
- 目次（TOC）のサイドバー化

### Phase 4: インフラ & DevOps

- Service Worker（Network-First）
- PWA マニフェスト
- RSS フィード生成
- CI パイプライン（HTML バリデーション, i18n キーチェック）
- PR テンプレート

## 実際の Git コミット

```
655c4b2 🚀 Phase 2-4 一括実装
074263f 🛠️ CI/CD・DevOps インフラ整備
a41fdd3 🍪 Cookie同意バナー実装
96631f9 ⚡ Phase 1 クイックウィン実装
```

**35ファイル変更、+6871行、-103行**

## AI 駆動開発で得た教訓

### ✅ うまくいったこと

1. **網羅性**: 人間が見落としがちな項目（ARIA, `rel` 属性, SRI）を漏れなく検出
2. **スピード**: 128項目を1セッションで提案 → 実装。手動なら数週間かかる作業
3. **一貫性**: コーディング規約に沿った統一的な実装
4. **学習**: 各修正の理由を説明しながら実装するため、技術知識が深まる

### ⚠️ 注意が必要だったこと

1. **CSSカスケード順序**: AI が新しいスタイルを追加した位置が既存のメディアクエリと衝突 → モバイル表示崩壊
2. **SRI ハッシュ**: ドキュメントからコピーしたハッシュが実ファイルと不一致 → ブロック
3. **二重実行バグ**: ブログ記事の描画関数が2回呼ばれ、シェアボタンが重複
4. **プレビュー必須**: コード生成だけでなく、実際にブラウザで確認する工程が不可欠

### 🔧 プロンプト改善

発見したバグの根本原因を分析し、`copilot-instructions.md` に再発防止ルールを追加しました:

- CSS カスケード順序の検証ルール（3つ）
- SRI ハッシュの実計算検証手順
- モバイル表示の構造的チェック項目

**プロンプトを改善することで、同じミスを繰り返さない仕組みを構築**しました。

## copilot-instructions.md の重要性

AI との開発で最も重要なのは、**プロジェクト固有のルールをプロンプトに明記すること**です。

当プロジェクトの `copilot-instructions.md` には以下を記載しています:

- ディレクトリ構造とファイルの役割
- コーディング規約（HTML / CSS / JS）
- セキュリティチェックリスト
- ブログ記事の追加手順
- i18n ルール
- Git ワークフロー
- 品質チェック項目
- 既知の注意点

これにより、Copilot はプロジェクトのコンテキストを理解した上でコードを生成できます。

## 数値で見る成果

| 指標 | Before | After |
|------|--------|-------|
| セキュリティヘッダー | 0 | CSP + 2つのメタタグ |
| ARIA 属性 | 一部欠落 | 全要素対応 |
| Cookie 同意 | なし | GDPR 準拠バナー |
| PWA | 非対応 | マニフェスト + SW |
| RSS | なし | feed.xml + 自動生成 |
| CI/CD | なし | HTML検証 + i18nチェック |
| ブログ UX | 基本機能のみ | TOC + シェア + 関連記事 |

## まとめ

GitHub Copilot による128項目のサイト改善は、**AI の網羅性 × 人間のレビュー** の組み合わせで効果を発揮しました。AIは大量の改善提案と実装を高速に行えますが、CSSのカスケード順序やSRIハッシュのような環境依存の問題は人間のレビューとプレビュー確認が不可欠です。

最終的に最も価値があったのは、バグの根本原因を分析して `copilot-instructions.md` に再発防止ルールを追加したことです。AI は指示書の品質に比例してアウトプットの品質が向上します。**プロンプトエンジニアリングは、AI 時代のソフトウェアエンジニアリングの一部**です。
